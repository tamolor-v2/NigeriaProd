select
msisdn_key MSISDN_NSK,
DATE_KEY,
coalesce(refill_count,0) as REFILL_CNT,
case when try_cast(substr(cast(ASPU as varchar),index(cast(ASPU as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(ASPU as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(ASPU as varchar),1,index(cast(ASPU as varchar),'.')-1) end as ASPU,
case when try_cast(substr(cast(total_sms_revenue as varchar),index(cast(total_sms_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(total_sms_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(total_sms_revenue as varchar),1,index(cast(total_sms_revenue as varchar),'.')-1) end as TOT_SMS_REV,
case when try_cast(substr(cast(total_data_revenue1 as varchar),index(cast(total_data_revenue1 as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(total_data_revenue1 as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(total_data_revenue1 as varchar),1,index(cast(total_data_revenue1 as varchar),'.')-1) end as TOT_DATA_REV,
case when try_cast(substr(cast(total_revenue as varchar),index(cast(total_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(total_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(total_revenue as varchar),1,index(cast(total_revenue as varchar),'.')-1) end as TOT_REV,
case when try_cast(substr(cast(total_refill_amount as varchar),index(cast(total_refill_amount as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(total_refill_amount as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(total_refill_amount as varchar),1,index(cast(total_refill_amount as varchar),'.')-1) end as REFILL_AMT,
case when try_cast(substr(cast(TOTAL_DECREMENT as varchar),index(cast(TOTAL_DECREMENT as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(TOTAL_DECREMENT as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(TOTAL_DECREMENT as varchar),1,index(cast(TOTAL_DECREMENT as varchar),'.')-1) end as TOTAL_DECREMENT,
case when try_cast(substr(cast(total_data_revenue2 as varchar),index(cast(total_data_revenue2 as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(total_data_revenue2 as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(total_data_revenue2 as varchar),1,index(cast(total_data_revenue2 as varchar),'.')-1) end as TOTAL_DATA_REV,
case when try_cast(substr(cast(total_vas_revenue as varchar),index(cast(total_vas_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(total_vas_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(total_vas_revenue as varchar),1,index(cast(total_vas_revenue as varchar),'.')-1) end as TOT_VAS_REV,
case when try_cast(substr(cast(data_2g_paygo_revenue as varchar),index(cast(data_2g_paygo_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(data_2g_paygo_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(data_2g_paygo_revenue as varchar),1,index(cast(data_2g_paygo_revenue as varchar),'.')-1) end as DAT_2G_PAYGO_REV,
case when try_cast(substr(cast(data_2g_bundled_revenue as varchar),index(cast(data_2g_bundled_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(data_2g_bundled_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(data_2g_bundled_revenue as varchar),1,index(cast(data_2g_bundled_revenue as varchar),'.')-1) end as DAT_2G_BUNDLE_REV,
case when try_cast(substr(cast(data_3g_paygo_revenue as varchar),index(cast(data_3g_paygo_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(data_3g_paygo_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(data_3g_paygo_revenue as varchar),1,index(cast(data_3g_paygo_revenue as varchar),'.')-1) end as DAT_3G_PAYGO_REV,
case when try_cast(substr(cast(data_3g_bundled_revenue as varchar),index(cast(data_3g_bundled_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(data_3g_bundled_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(data_3g_bundled_revenue as varchar),1,index(cast(data_3g_bundled_revenue as varchar),'.')-1) end as DAT_3G_BUNDLE_REV,
case when try_cast(substr(cast(data_4g_paygo_revenue as varchar),index(cast(data_4g_paygo_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(data_4g_paygo_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(data_4g_paygo_revenue as varchar),1,index(cast(data_4g_paygo_revenue as varchar),'.')-1) end as DAT_4G_PAYGO_REV,
case when try_cast(substr(cast(data_4g_bundled_revenue as varchar),index(cast(data_4g_bundled_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(data_4g_bundled_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(data_4g_bundled_revenue as varchar),1,index(cast(data_4g_bundled_revenue as varchar),'.')-1) end as DAT_4G_BUNDLE_REV,
case when try_cast(substr(cast(total_data_paygo_revenue as varchar),index(cast(total_data_paygo_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(total_data_paygo_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(total_data_paygo_revenue as varchar),1,index(cast(total_data_paygo_revenue as varchar),'.')-1) end as TOT_DAT_PAYGO_REV,
case when try_cast(substr(cast(total_data_bundled_revenue as varchar),index(cast(total_data_bundled_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(total_data_bundled_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(total_data_bundled_revenue as varchar),1,index(cast(total_data_bundled_revenue as varchar),'.')-1) end as TOT_BUNDLE_REV,
case when try_cast(substr(cast(international_sms_revenue as varchar),index(cast(international_sms_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(international_sms_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(international_sms_revenue as varchar),1,index(cast(international_sms_revenue as varchar),'.')-1) end as INT_SMS_REV,
case when try_cast(substr(cast(international_data_revenue as varchar),index(cast(international_data_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(international_data_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(international_data_revenue as varchar),1,index(cast(international_data_revenue as varchar),'.')-1) end as INT_DATA_REV,
case when try_cast(substr(cast(total_ic_revenue as varchar),index(cast(total_ic_revenue as varchar),'.')+1) as integer)>0 then try_cast(try_cast(try_cast(cast(total_ic_revenue as varchar) as decimal(18,2)) as double) as varchar) else substr(cast(total_ic_revenue as varchar),1,index(cast(total_ic_revenue as varchar),'.')-1) end as TOT_IC_REV
from nigeria.cm_revenue_sit_f;
